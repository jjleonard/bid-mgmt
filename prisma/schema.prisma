generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
}

model Bid {
  id         String    @id @default(cuid())
  clientName String
  bidName    String
  status     BidStatus
  opportunityType OpportunityType @default(single_tender)
  currentStage BidStage?
  nextStageDate DateTime?
  psqReceivedAt DateTime?
  psqClarificationDeadlineAt DateTime?
  psqSubmissionDeadlineAt DateTime?
  psqSubmissionTime String?
  ittReceivedAt DateTime?
  ittClarificationDeadlineAt DateTime?
  ittSubmissionDeadlineAt DateTime?
  ittSubmissionTime String?
  tcvGbp Int?
  initialTermMonths Int?
  extensionTermMonths Int?
  tcvTermBasis TcvTermBasis?
  annualValueGbp Int?
  portalUrl String?
  folderUrl  String
  createdAt  DateTime  @default(now())
  updatedAt  DateTime  @updatedAt
  auditEvents AuditEvent[]
}

model AuditEvent {
  id        String       @id @default(cuid())
  bidId     String?
  bidIdSnapshot String?
  bidLabel  String?
  action    String       @default("update")
  actor     String       @default("system")
  createdAt DateTime     @default(now())
  bid       Bid?         @relation(fields: [bidId], references: [id], onDelete: SetNull)
  changes   AuditChange[]
}

model AuditChange {
  id        String     @id @default(cuid())
  eventId   String
  field     String
  fromValue String
  toValue   String
  createdAt DateTime   @default(now())
  event     AuditEvent @relation(fields: [eventId], references: [id], onDelete: Cascade)
}

enum BidStatus {
  pending
  pipeline
  in_progress
  bid
  no_bid
  submitted
  won
  lost
  dropped
  abandoned
}

enum OpportunityType {
  single_tender
  combined_psq_itt
  two_stage_psq_itt
}

enum BidStage {
  psq
  itt
}

enum TcvTermBasis {
  initial_only
  initial_plus_extension
}
